<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Method Abstraction in Agentic RAG Project</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.7;
            color: #1a1a2e;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 50px 60px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: rgba(102, 126, 234, 0.15);
            border-radius: 50%;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.85;
            font-weight: 400;
        }
        
        .header .project-badge {
            display: inline-block;
            background: rgba(102, 126, 234, 0.3);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 15px;
            font-weight: 500;
        }
        
        .content {
            padding: 50px 60px;
        }
        
        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a2e;
            margin: 35px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: inline-block;
        }
        
        h2:first-of-type {
            margin-top: 0;
        }
        
        h3 {
            font-size: 1.15rem;
            font-weight: 600;
            color: #16213e;
            margin: 25px 0 12px;
        }
        
        p {
            margin-bottom: 15px;
            color: #444;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-left: 4px solid #667eea;
            padding: 20px 25px;
            border-radius: 0 12px 12px 0;
            margin: 25px 0;
        }
        
        .highlight-box.success {
            background: linear-gradient(135deg, #f0fff4 0%, #e6ffed 100%);
            border-left-color: #38a169;
        }
        
        .highlight-box.critical {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border-left-color: #e53e3e;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-radius: 12px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 14px 20px;
            border-bottom: 1px solid #eee;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:nth-child(even) {
            background: #f8f9ff;
        }
        
        code {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.85rem;
        }
        
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .keyword { color: #c586c0; }
        .function { color: #dcdcaa; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; }
        .type { color: #4ec9b0; }
        
        .diagram {
            background: #1a1a2e;
            color: #a8dadc;
            padding: 25px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
            margin: 25px 0;
        }
        
        .benefit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        
        .benefit-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .benefit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .benefit-card .icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .benefit-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 8px;
        }
        
        .benefit-card p {
            font-size: 0.9rem;
            color: #666;
            margin: 0;
        }
        
        .file-ref {
            display: inline-flex;
            align-items: center;
            background: #edf2f7;
            padding: 4px 12px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #667eea;
            text-decoration: none;
            margin: 2px 0;
        }
        
        .file-ref::before {
            content: 'ğŸ“„';
            margin-right: 6px;
        }
        
        .conclusion {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-top: 40px;
            text-align: center;
        }
        
        .conclusion h3 {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }
        
        .conclusion p {
            color: rgba(255,255,255,0.9);
            margin: 0;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: #f8f9ff;
            color: #666;
            font-size: 0.85rem;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            .benefit-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Method Abstraction</h1>
            <p class="subtitle">A Case Study from the Agentic RAG Project</p>
            <span class="project-badge">ğŸ“‚ lib/podcast.ts</span>
        </div>
        
        <div class="content">
            <h2>ğŸ¯ The Abstraction Pattern</h2>
            <p>The podcast generation system demonstrates excellent method abstraction by separating concerns into focused, single-responsibility functions:</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Responsibility</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>generatePodcastScript()</code></td>
                        <td>Converts text â†’ dialogue JSON using Groq LLM</td>
                    </tr>
                    <tr>
                        <td><code>synthesizePodcastAudio()</code></td>
                        <td>Converts dialogue â†’ WAV audio using Cartesia TTS</td>
                    </tr>
                    <tr>
                        <td><code>generateStoryScript()</code></td>
                        <td>Converts text â†’ first-person narration JSON</td>
                    </tr>
                    <tr>
                        <td><code>synthesizeStoryAudio()</code></td>
                        <td>Converts narration â†’ WAV audio with Narrator voice</td>
                    </tr>
                </tbody>
            </table>

            <h2>âœ… How Abstraction Helped: Adding Story Mode</h2>
            
            <div class="highlight-box success">
                <strong>Key Insight:</strong> When Story Mode was added, the existing abstraction pattern made it trivial to implement. The new feature followed the exact same patterns with minimal code changes.
            </div>

            <h3>Story Mode Implementation</h3>
            <p>The Story Mode feature reuses the same patterns as Podcast Mode. Here's how the code leverages abstraction:</p>
            
            <pre><code><span class="comment">// Story Mode reuses the SAME pattern as Podcast Mode!</span>
<span class="keyword">export async function</span> <span class="function">generateStoryScript</span>(text: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">StoryScriptItem</span>[]&gt; {
    <span class="comment">// Only the PROMPT differs - logic is identical</span>
    <span class="keyword">const</span> systemPrompt = <span class="string">`You are an expert storyteller... FIRST PERSON...`</span>;
    <span class="comment">// ... same Groq call pattern</span>
}

<span class="keyword">export async function</span> <span class="function">synthesizeStoryAudio</span>(script: <span class="type">StoryScriptItem</span>[]): <span class="type">Promise</span>&lt;<span class="type">Buffer</span>&gt; {
    <span class="comment">// Nearly identical to synthesizePodcastAudio</span>
    voice: { mode: <span class="string">"id"</span>, id: VOICES.NARRATOR }
    <span class="comment">// ... same Cartesia TTS call pattern</span>
}</code></pre>

            <h3>Orchestrator Pattern in actions.ts</h3>
            <pre><code><span class="keyword">export async function</span> <span class="function">generateStory</span>(documentIds: <span class="type">string</span>[]) {
    <span class="comment">// Same orchestration pattern as generatePodcast()</span>
    <span class="keyword">const</span> script = <span class="keyword">await</span> <span class="function">generateStoryScript</span>(fullText);   <span class="comment">// â† Swap method</span>
    <span class="keyword">const</span> audioBuffer = <span class="keyword">await</span> <span class="function">synthesizeStoryAudio</span>(script); <span class="comment">// â† Swap method</span>
    <span class="comment">// ... same storage logic</span>
}</code></pre>

            <h2>ğŸ”‘ Why This Abstraction is Critical</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Without Abstraction</th>
                        <th>With Abstraction</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Adding Story Mode</strong></td>
                        <td>Duplicate ~150 lines, mix LLM/TTS/storage logic</td>
                        <td>Add 2 new functions + swap calls</td>
                    </tr>
                    <tr>
                        <td><strong>Changing TTS Provider</strong></td>
                        <td>Modify everywhere Cartesia is called</td>
                        <td>Modify only synthesize*Audio() functions</td>
                    </tr>
                    <tr>
                        <td><strong>Changing LLM</strong></td>
                        <td>Hunt down all Groq calls</td>
                        <td>Modify only generate*Script() functions</td>
                    </tr>
                    <tr>
                        <td><strong>Unit Testing</strong></td>
                        <td>Impossible to test LLM vs TTS separately</td>
                        <td>Each function is independently testable</td>
                    </tr>
                    <tr>
                        <td><strong>Bug Fixes</strong></td>
                        <td>WAV bug would exist in 2+ places</td>
                        <td>Fixed once in one location</td>
                    </tr>
                </tbody>
            </table>

            <h2>ğŸ“ Single Responsibility Principle in Action</h2>
            
            <div class="diagram">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     generatePodcast()                        â”‚
â”‚   (Orchestrator - only knows WHAT to do, not HOW)           â”‚
â”‚                                                              â”‚
â”‚   1. Fetch chunks from database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   2. generatePodcastScript(text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚   3. synthesizePodcastAudio(script) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚   4. Upload to storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚   Each step is abstracted - orchestrator doesn't know       â”‚
â”‚   about Groq API calls or Cartesia TTS internals!           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

            <h2>ğŸ’¡ Key Benefits</h2>
            
            <div class="benefit-grid">
                <div class="benefit-card">
                    <div class="icon">ğŸ”„</div>
                    <h4>Easy Feature Addition</h4>
                    <p>Story Mode required zero changes to existing podcast code.</p>
                </div>
                <div class="benefit-card">
                    <div class="icon">ğŸ›¡ï¸</div>
                    <h4>Zero Breaking Risk</h4>
                    <p>New features don't risk breaking existing functionality.</p>
                </div>
                <div class="benefit-card">
                    <div class="icon">ğŸ§ª</div>
                    <h4>Testability</h4>
                    <p>Each function can be unit tested in isolation.</p>
                </div>
                <div class="benefit-card">
                    <div class="icon">ğŸ”§</div>
                    <h4>Easy Maintenance</h4>
                    <p>Bug fixes apply everywhere automatically.</p>
                </div>
            </div>

            <div class="highlight-box">
                <strong>Files Referenced:</strong><br><br>
                <span class="file-ref">lib/podcast.ts</span> â€” Core abstraction layer with script generation and audio synthesis<br><br>
                <span class="file-ref">app/actions.ts</span> â€” Server actions that orchestrate the abstracted methods<br><br>
                <span class="file-ref">lib/cartesia.ts</span> â€” TTS client configuration and voice constants
            </div>

            <div class="conclusion">
                <h3>ğŸ‰ The Result</h3>
                <p>Method abstraction enabled adding Story Mode with minimal code, zero risk to existing features, and clean separation of concerns. This is a textbook example of the Single Responsibility Principle!</p>
            </div>
        </div>
        
        <div class="footer">
            ğŸ“… Generated on January 1, 2026 â€¢ Agentic RAG Project Documentation
        </div>
    </div>
</body>
</html>
